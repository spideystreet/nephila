# Nephila E2E test prompts — versioned interaction test cases.
# Each case has a prompt and assertions on the agent's final response.
#
# Fields:
#   id          : unique identifier
#   prompt      : user message sent to the agent
#   expect_warn : true if a critical interaction (Contre-indication / Association déconseillée) must be flagged
#   expect_in   : strings that MUST appear in the response (case-insensitive)
#   expect_not  : strings that must NOT appear (false-positive guard)

# --- expect_warn: true -------------------------------------------------------

# Association déconseillée: AINS potentiate MTX toxicity
# DB pair: METHOTREXATE + ANTI-INFLAMMATOIRES NON STÉROÏDIENS (AD)
- id: ibuprofene_methotrexate
  prompt: >
    Mon patient est suivi pour un psoriasis sous méthotrexate faible dose.
    Il a de la fièvre et demande s'il peut prendre de l'ibuprofène. Est-ce compatible ?
  expect_warn: true
  expect_in:
    - "⚠️"
    - "méthotrexate"
  expect_not:
    - "trimethoprime"
    - "probenecide"

# Contre-indication: ciclosporine inhibits CYP3A4, simvastatine is a substrate → rhabdomyolysis
# DB pair: CICLOSPORINE + SIMVASTATINE (CI)
- id: ciclosporine_simvastatine
  prompt: >
    Patient greffé rénal sous ciclosporine. Son bilan lipidique est perturbé
    et le cardiologue envisage d'introduire de la simvastatine.
    Y a-t-il un risque d'interaction ?
  expect_warn: true
  expect_in:
    - "⚠️"
    - "simvastatine"
  expect_not:
    - "lithium"

# --- expect_warn: false ------------------------------------------------------

# Précaution d'emploi: amiodarone increases simvastatine exposure (CYP3A4 inhibition)
# DB pair: AMIODARONE + SIMVASTATINE (PE) — exact DCI names, no class name needed
- id: amiodarone_simvastatine
  prompt: >
    Patient sous amiodarone 200 mg/j pour une fibrillation auriculaire.
    Son médecin veut ajouter de la simvastatine pour une dyslipidémie.
    Y a-t-il une interaction connue ?
  expect_warn: false
  expect_in:
    - "simvastatine"
  expect_not:
    - "⚠️"

# True negative: no known pharmacological interaction between these two drugs
- id: paracetamol_amoxicilline
  prompt: >
    Mon patient a une angine bactérienne traitée par amoxicilline.
    Il souhaite prendre du paracétamol pour la douleur et la fièvre.
    Y a-t-il une interaction entre ces deux médicaments ?
  expect_warn: false
  expect_in:
    - "paracétamol"
  expect_not:
    - "⚠️"

# Different tool path: tests search_drug → find_generics chain
- id: generiques_doliprane
  prompt: >
    Quels sont les médicaments génériques disponibles pour le Doliprane ?
  expect_warn: false
  expect_in:
    - "paracétamol"
  expect_not:
    - "⚠️"
